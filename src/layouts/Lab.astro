---
import Default from "./Default.astro";
import Link from "../components/Link.astro";

interface Props {
	title: string;
	excerpt: string;
	versions?: any[];
	currentSlug?: string;
}

const { title, excerpt, versions = [], currentSlug } = Astro.props;
const showVersions = versions.length > 1;
---

<Default title={title} description={excerpt}>
	<script is:inline src="/p5.min.js"></script>
	
	<div class="relative">
		{showVersions && (
			<aside class="mb-8 md:mb-0 md:absolute md:left-[calc(72ch+8ch)] md:top-0 md:w-[32ch]">
				<nav class="md:sticky md:top-10 space-y-3">
					<h3 class="text-muted-foreground">versions</h3>
					<ul class="space-y-3 md:max-h-[70vh] md:overflow-y-auto">
						{versions.reverse().map((v) => {
							const isCurrent = v.slug === currentSlug;
							return (
								<li>
									{isCurrent ? (
										<div class="space-y-1">
											<div class="font-bold">v{v.data.version || 1}: {v.data.title.replace(/^murmuration v\d+:?\s*/i, '')}</div>
										</div>
									) : (
										<Link href={`/lab/${v.slug}`}>
											<div class="space-y-1">
												<div>v{v.data.version || 1}: {v.data.title.replace(/^murmuration v\d+:?\s*/i, '')}</div>
											</div>
										</Link>
									)}
								</li>
							);
						})}
					</ul>
				</nav>
			</aside>
		)}
		
		<article class="w-full md:max-w-[72ch] space-y-5 markdown">
			<slot />
		</article>
	</div>
</Default>
