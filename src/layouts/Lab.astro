---
import Default from "./Default.astro";
import Link from "../components/Link.astro";
import P5Sketch from "../components/P5Sketch.astro";

interface Props {
	title: string;
	excerpt: string;
	versions?: any[];
	currentSlug?: string;
}

const { title, excerpt, versions = [], currentSlug } = Astro.props;
const showVersions = versions.length > 1;
---

<Default title={title} description={excerpt}>
	<P5Sketch />
	
	<div class="relative">
		{showVersions && (
			<aside class="mb-8 lg:mb-0 lg:absolute lg:left-[calc(72ch+8ch)] lg:top-0 lg:w-[32ch]">
				<nav class="lg:sticky lg:top-10 space-y-3">
					<h3 class="text-muted-foreground">versions</h3>
					<ul class="space-y-3 lg:max-h-[70vh] lg:overflow-y-auto">
						{versions.reverse().map((v) => {
							const isCurrent = v.slug === currentSlug;
							return (
								<li>
									{isCurrent ? (
										<div class="space-y-1">
											<div class="font-bold">v{v.data.version || 1}: {v.data.title.replace(/^murmuration v\d+:?\s*/i, '')}</div>
										</div>
									) : (
										<Link href={`/lab/${v.slug}`}>
											<div class="space-y-1">
												<div>v{v.data.version || 1}: {v.data.title.replace(/^murmuration v\d+:?\s*/i, '')}</div>
											</div>
										</Link>
									)}
								</li>
							);
						})}
					</ul>
				</nav>
			</aside>
		)}
		
		<article class="w-full lg:max-w-[72ch] space-y-5 markdown">
			<slot />
		</article>
	</div>
</Default>
